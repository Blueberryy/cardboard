currentmaps = "aard3c flux fz_burn highland illusion maze neo_falls neo_noir retrograde ruins zsolttest"
shadowmaps = "color"
parkourmaps = "ftdeluxe secondevermap"
ctfmaps = "hr retrograde zigguraut"

allmaps = (concat $currentmaps $shadowmaps $ctfmaps $parkourmaps)

genmapitems = [
    looplist curmap $arg1 [
        guibutton $curmap (concat map $curmap) "map"
    ]
]

showmapshot = [
    guibar
    guiimage (concatword "packages/base/" (if (> $numargs 0) [result $arg1] [at $guirollovername 0]) ".png") $guirolloveraction 4 1 "data/cardboard.png"
]

newgui maps [
	custommaps = ""
	loopfiles curmap "packages/base" "cmr" [
		if (< (indexof $allmaps $curmap) 0) [
			custommaps = (concat $custommaps $curmap)
		]
	]
	custommaps = (sortlist $custommaps x y [<=s $x $y])

	custommaps1 = ""
	custommaps2 = ""

	looplist2 map1 map2 $custommaps [
		custommaps1 = (concat $custommaps1 $map1)
		custommaps2 = (concat $custommaps2 $map2)
	]
    guilist [
      guistrut 17 1
      guilist [ guistrut 15 1; genmapitems $currentmaps ]
      guilist [ guistrut 15 1]
      showmapshot
    ]
	guitab "t:gui.map.shadow"
	guilist [
      guistrut 17 1
      guilist [ guistrut 15 1; genmapitems $shadowmaps ]
      guilist [ guistrut 15 1]
      showmapshot
    ]
	guitab "t:gui.map.ctf"
    guilist [
      guistrut 17 1
      guilist [ guistrut 15 1; genmapitems $ctfmaps ]
      guilist [ guistrut 15 1 ]
      showmapshot
    ]
    guitab "t:gui.map.parkour"
    guilist [
      guistrut 17 1
      guilist [ guistrut 15 1; genmapitems $parkourmaps ]
      guilist [ guistrut 15 1 ]
      showmapshot
    ]
	guitab "t:gui.map.custom"
    guilist [
      guistrut 17 1
	  guilist [ guistrut 15 1; genmapitems $custommaps1 ]
      guilist [ guistrut 15 1; genmapitems $custommaps2 ]
      showmapshot
    ]
] "t:gui.map"

//newgui maps2 [
//    looplist curmap $custommaps [
//        guibutton $curmap (concat map $curmap) "map"
//    ]
//] "Available maps"
//showcustommaps = [
//    custommaps = ""
//    loopfiles curmap "packages/base" "cmr" [
//        if (< (indexof $allmaps $curmap) 0) [
//            custommaps = (concat $custommaps $curmap)
//        ]
//    ]
//    custommaps = (sortlist $custommaps x y [<=s $x $y])
//    showgui maps2
//]

// prepare yourself for bad -Y 09/12/19

dbgmap = [
    dbg_disablelightmap 1
    map $arg1
    calclight
    savemap $arg1
    disconnect
    dbg_disablelightmap 0
    map $arg1
    calclight
    savemap $arg1
	disconnect
	map $arg1
	echo "dbgmap done"
]

complete dbgmap packages/base cmr